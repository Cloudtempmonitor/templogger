<!DOCTYPE html>
<html lang="pt-BR">
<head>

    <meta name="theme-color" content="#2c3e50">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./img/icon-192.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">



    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Dispositivo</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.4.0/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon">
    <link rel="icon" href="./img/favicon.png" type="image/png">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="../css/device-details.css"> <link rel="stylesheet" href="../css/notifications.css">
</head>
<body>
<div id="menu-container"></div>
    
    <div id="content">
         <div id="details-header">
            <h1>Detalhes do Dispositivo: <span id="device-name"></span></h1>
        </div>
            
        

        <div id="device-status" class="status-container">
            <div id="realtime-status-box" class="status-box normal">
                <strong id="realtime-status-text">CARREGANDO...</strong>
                <span id="realtime-status-detail">Aguardando dados...</span>
            </div>

            <div class="last-reading-box">
                <h4>üì° √öltimas Leituras</h4>
                <p id="last-reading"></p>
                <p id="last-update-time"></p>
            </div>
        </div>

        <div id="device-info-card" class="info-grid">
            <div class="info-box">
                <h4>üìå Localiza√ß√£o</h4>
                <p><strong>Unidade:</strong> <span id="info-unidade">N/A</span></p>
                <p><strong>Setor:</strong> <span id="info-setor">N/A</span></p>
            </div>
            <div class="info-box">
                <h4>‚öôÔ∏è Configura√ß√µes Atuais</h4>
                <ul id="info-config-list" style="margin-bottom: 15px;"></ul>
                <div id="info-limits-table"></div>
            </div>
        </div>

        <div id="graph-section">
            <h2>Gr√°fico e Filtros</h2>
            <div style="text-align: center; margin: 15px 0">
                <label>Per√≠odo R√°pido: </label>
                <select id="time-filter">
                    <option value="12" selected>12 horas</option>
                    <option value="24">24 horas</option>
                    <option value="72">3 dias</option>
                    <option value="168">7 dias</option>
                    <option value="custom" hidden>Personalizado</option>
                </select>
                <br /><br />

                <label>Per√≠odo: </label>
                <input type="text" id="date-range-picker" placeholder="Selecione o per√≠odo..." style="width: 280px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 0.95em; text-align: center;" />

                <button id="update-button" style="padding: 10px 15px; margin-left: 10px; cursor: pointer; background: var(--cor-destaque-azul); color: white; border: none; border-radius: 5px; font-size: 1em;">
                    Atualizar
                </button>
            </div>
            <div>
                <canvas id="device-chart"></canvas>
            </div>
            <button id="export-csv">Exportar Dados como CSV</button>
        </div>

        <div id="alarms-section">
            <h2>Hist√≥rico de Alarmes (do per√≠odo filtrado)</h2>
            <ul id="alarm-list"></ul>
        </div>

        <div id="stats-section">
            <h2>Estat√≠sticas do Per√≠odo</h2>
            <div id="stats-summary"></div>
        </div>
        </div>

     <div id="alarm-graph-modal" class="modal-overlay" style="display: none">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2 id="modal-title">üìà Detalhes do Evento</h2>
                <div class="modal-device-info-header">
                    <span id="modal-device-name"></span>
                    <span id="modal-device-mac"></span>
                </div>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>

            <div class="modal-body" style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px">
                <div class="event-data-panel">
                    <div class="info-card">
                        <h3>‚è∞ Per√≠odo do Evento</h3>
                        <p><strong>In√≠cio:</strong> <span id="modal-alarm-start"></span></p>
                        <p><strong>Fim:</strong> <span id="modal-alarm-end"></span></p>
                        <p><strong>Dura√ß√£o:</strong> <span id="modal-alarm-duration"></span></p>
                    </div>
                    <div class="info-card">
                        <div id="modal-alarm-trigger"></div>
                    </div>
                    <div class="info-card">
                        <div id="modal-event-details"></div>
                    </div>
                </div>

                <div class="chart-panel">
                    <div style="height: 400px">
                        <canvas id="modal-chart"></canvas>
                    </div>
                    <div style="margin-top: 20px; text-align: center">
                        <button id="export-png-btn" class="btn btn-primary">
                            üì• Exportar Relat√≥rio
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="../js/core/auth.js"></script>
    <script type="module" src="../js/ui/menu.js"></script>
    <script type="module" src="../js/pages/device-details.js"></script>

   <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      // Registra APENAS o service worker unificado
      navigator.serviceWorker
        .register("./service-worker.js")
        .then((reg) => {
          console.log("Service Worker unificado registrado:", reg.scope);
        })
        .catch((err) => console.error("Falha ao registrar SW:", err));
    });
  }
</script>

</body>
</html>
